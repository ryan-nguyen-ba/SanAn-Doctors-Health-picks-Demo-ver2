# Health Picks 実装計画書

## プロジェクト概要

**プロダクト名**: Health Picks  
**目標**: 日本におけるサプリ利用率70%向上への寄与  
**アーキテクチャ**: ポータル型（EC機能なし、外部誘導のみ）

---

## 3ポータル構成

### 1. 提供者側ポータル（Provider Portal）
**役割**: コンテンツ・サービス管理

**主要機能**:
- ✅ 栄養素材・製品管理
- ✅ チャレンジ／レシピ／ミニミッション管理
- ✅ 記事・動画配信管理
- ✅ ユーザー管理（法人・従業員）
- ✅ データ集計・分析

### 2. 従業員向けポータル（Employee Portal）
**役割**: 健康行動・記録・チャレンジ実行

**主要機能**:
- ✅ トップページ（本日のミッション）
- ✅ アンケート（初回必須、定期実施）
- ✅ チャレンジ一覧・詳細
- ✅ ミニミッション実行
- ✅ 実感チェック・スコア
- ✅ マイサプリ管理
- ✅ 副作用・体調記録
- ✅ 通知・チャット

### 3. 人事（管理者）向けポータル（HR Portal）
**役割**: 分析・管理・通知

**主要機能**:
- ✅ ダッシュボード（利用状況・継続率）
- ✅ チャレンジ分析
- ✅ 副作用・体調分析
- ✅ 通知・リマインド管理
- ✅ 利用者管理
- ✅ 社販管理
- ✅ お知らせ配信

---

## 実装フェーズ

### Phase 1: 従業員向けコアフロー（最優先）🚀

**目標**: 基本的なユーザーフローを実現

```
アンケート → 推薦 → チャレンジ → ミニミッション → ログ
```

**実装タスク**:

1. **アンケート機能**
   - [ ] 初回アンケート画面（既存実装あり）
   - [ ] アンケート結果保存
   - [ ] チャレンジ推薦アルゴリズム
   - [ ] 定期アンケートリマインド

2. **チャレンジ機能**
   - [ ] チャレンジ一覧（既存実装あり）
   - [ ] チャレンジ詳細
   - [ ] チャレンジ開始
   - [ ] レシピタイムライン表示

3. **ミニミッション機能**
   - [ ] 本日のミッション表示
   - [ ] ミッション完了チェック
   - [ ] ポイント付与
   - [ ] ログ記録

4. **ログ機能**
   - [ ] 副作用記録
   - [ ] 体調記録
   - [ ] 食事写真アップロード（β版は基本のみ）

**期間**: 4-6週間

---

### Phase 2: 提供者側コンテンツ管理 📝

**目標**: コンテンツ管理機能の実装

**実装タスク**:

1. **製品情報管理**
   - [ ] 栄養素材CRUD
   - [ ] 製品CRUD
   - [ ] 購入リンク管理

2. **チャレンジ管理**
   - [ ] チャレンジCRUD
   - [ ] レシピCRUD
   - [ ] ミニミッションCRUD
   - [ ] 公開状態管理

3. **コンテンツ配信**
   - [ ] 記事・動画登録
   - [ ] 配信スケジュール管理
   - [ ] 配信対象設定

4. **ユーザー管理**
   - [ ] 法人（テナント）管理
   - [ ] 従業員一覧・検索
   - [ ] 招待機能

**期間**: 3-4週間

---

### Phase 3: 人事ダッシュボード・管理・通知 📊

**目標**: 分析・管理機能の実装

**実装タスク**:

1. **ダッシュボード**
   - [ ] 利用状況グラフ
   - [ ] 継続率表示
   - [ ] スコア分布
   - [ ] 部署別比較

2. **分析機能**
   - [ ] チャレンジ実施率分析
   - [ ] 副作用・体調分析
   - [ ] CSVエクスポート

3. **管理機能**
   - [ ] 利用者管理（一覧・検索・フィルタ）
   - [ ] 通知・リマインド管理
   - [ ] 社販管理（補助・クーポン）

4. **通知機能**
   - [ ] Email通知
   - [ ] LINE通知
   - [ ] Push通知（PWA）

**期間**: 3-4週間

---

## 技術スタック

### フロントエンド（現在）
- **Framework**: React 18
- **Build Tool**: Vite
- **Routing**: React Router v6
- **Styling**: CSS (BEM記法)
- **State Management**: React Hooks / Context API

### バックエンド（推奨）
- **API**: RESTful API hoặc GraphQL
- **認証**: JWT
- **データベース**: PostgreSQL
- **ファイルストレージ**: AWS S3 hoặc tương đương

### インフラ
- **Hosting**: AWS / GCP / Azure
- **CDN**: CloudFront / Cloudflare
- **Monitoring**: CloudWatch / Datadog

---

## データベース設計（主要テーブル）

```
tenants
├── id
├── name
├── plan_type
└── feature_flags

users
├── id
├── tenant_id (FK)
├── email
├── role
└── profile

challenges
├── id
├── tenant_id (FK)
├── name
├── purpose
└── target_conditions

recipes
├── id
├── challenge_id (FK)
├── name
└── day_number

mini_missions
├── id
├── recipe_id (FK)
├── type
└── content_url

supplement_products
├── id
├── tenant_id (FK)
├── name
└── purchase_url

surveys
├── id
├── tenant_id (FK)
├── user_id (FK)
└── responses

logs
├── id
├── tenant_id (FK)
├── user_id (FK)
├── mission_id (FK)
└── data
```

---

## セキュリティ要件

### マルチテナント分離
- ✅ すべてのクエリに`tenant_id`必須
- ✅ データアクセス制御（Row Level Security）

### 認証・認可
- ✅ JWT Token認証
- ✅ RBAC実装（Provider/Employee/HR Admin）
- ✅ ロール別アクセス制御

### データ保護
- ✅ HTTPS必須
- ✅ PII暗号化
- ✅ ログ監査

---

## 現在の実装状況

### ✅ 完了
- React app基盤構築
- ルーティング設定
- 基本レイアウト（Header, Sidebar）
- 従業員ポータル基本画面:
  - ログイン
  - ホーム
  - アンケート（UI実装）
  - チャレンジ一覧
  - ミッション一覧
  - レシピ一覧
  - タイムライン

### 🚧 進行中
- サンプルデータ追加
- UI/UX改善

### 📋 未実装
- バックエンドAPI
- 認証機能
- データベース
- 提供者ポータル
- 人事ポータル
- 通知機能

---

## 次のステップ

### 即座に実装可能
1. **アンケート結果保存機能**（フロントエンド）
2. **チャレンジ推薦ロジック**（フロントエンド、モックデータ）
3. **ミッション完了機能**（フロントエンド）
4. **ログ記録UI**（フロントエンド）

### バックエンド準備
1. **API設計詳細化**
2. **データベーススキーマ設計**
3. **認証システム設計**
4. **マルチテナント実装**

---

## リスクと対策

### リスク1: マルチテナント分離の複雑さ
**対策**: 早期にテナント分離ロジックを実装・テスト

### リスク2: パフォーマンス（大量データ）
**対策**: インデックス最適化、キャッシュ戦略、ページネーション

### リスク3: セキュリティ（データ漏洩）
**対策**: セキュリティ監査、ペネトレーションテスト

---

**最終更新**: 2024年12月  
**ステータス**: フロントエンド基盤構築完了、バックエンド設計中


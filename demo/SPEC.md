# Health Picks システム仕様書

## 事業ゴール

日本におけるサプリの利用率を70%まで向上することに寄与する。企業の健康経営支援とサプリメント継続利用促進を両立する総合健康プラットフォームの構築と普及。

## プロジェクトゴール

事業ゴール達成に向けた1stステップとして、プラットフォームのβ版を構築し、PoC(概念実証)の準備を行う。

### 実現したい姿

Health picksは取引基盤ではなく、情報提供と誘導を担うポータルモデルとして構築される。販売・在庫・発送を担わず、メーカー既存ECへ誘導し、シンプルかつ柔軟な運用を実現する。

---

## システム概要

本システムは、法人（テナント）向けに健康支援サービスを提供するポータル型アプリケーションであり、以下3種類のポータルで構成される。

- **提供者側ポータル**（コンテンツ・サービス管理）
- **従業員向けポータル**（健康行動・記録・チャレンジ実行）
- **人事（管理者）向けポータル**（分析・管理・通知）

**重要**: EC機能は持たず、製品購入はすべて外部サービスへの遷移とする。

---

## 1. 共通仕様（全ポータル共通）

### 1.1 マルチテナント仕様

- 法人を**テナント（tenant）**として管理する
- すべてのデータは`tenant_id`により完全分離されること
  - 従業員データ
  - アンケート・チャレンジ・ログ
  - 分析結果
  - 通知・クーポン

### 1.2 ロール・権限管理（RBAC）

以下のロールを持つ：

| ロール | 説明 |
|--------|------|
| **Provider** | 提供者側（サービス運営・コンテンツ管理） |
| **Employee** | 従業員 |
| **HR Admin** | 法人管理者（人事） |

- ロールに応じてアクセス可能な画面・APIを制限する
- 他ロールのポータルへの直接アクセスは禁止

### 1.3 ECポリシー

- 注文／決済／在庫／配送は管理しない
- 製品情報は**情報表示のみ**
- 購入は外部リンク（通常URL／アフィリエイト／API）へ遷移

---

## 2. 提供者側ポータル仕様（Provider Portal）

### 2.1 製品情報管理

#### 2.1.1 栄養素材管理（Ingredient）

- 栄養素材のCRUDを行う
- **管理項目**：
  - 栄養素材名
  - 栄養素情報（成分名／量／単位、JSON形式可）
  - 説明文
  - 注意事項（副作用等）
  - 公開／非公開フラグ

#### 2.1.2 製品管理（Supplement Product）

- サプリメント製品のCRUDを行う
- **管理項目**：
  - 製品名
  - 関連栄養素材（複数）
  - 効果・効能説明
  - 注意点・副作用
  - **購入導線情報**
    - 通常URL
    - アフィリエイトリンク
    - 外部API情報（必要な場合）

> **重要**: 従業員ポータルの購入ボタンは、必ずここで登録されたリンクに遷移する

### 2.2 チャレンジ／レシピ／ミニミッション管理

#### 2.2.1 チャレンジ管理

- チャレンジのCRUD
- **管理項目**：
  - チャレンジ名
  - 目的（改善したい課題）
  - 対象条件（年齢・性別・アンケート結果等）
  - 実施期間（任意）
  - 推奨フラグ／優先度
  - 公開状態

#### 2.2.2 レシピ管理

- チャレンジ配下でレシピを管理
- **管理項目**：
  - レシピ名
  - 実施日数（Day1〜）
  - 構成内容（食事／運動／睡眠／サプリ等）
  - 専門家コメント（任意）

#### 2.2.3 ミニミッション管理

- レシピ配下でミニミッションを管理
- **管理項目**：
  - ミッション種別（記事／動画）
  - コンテンツ本文または動画URL
  - 実施日（Day番号）
  - 付与ポイント
  - 関連サプリ（複数可）

### 2.3 記事・動画配信管理

- 記事／動画コンテンツの登録
- **配信スケジュール管理**：
  - 公開日時
  - 配信対象（全員／特定チャレンジ／条件）
  - 公開／下書きステータス管理

### 2.4 ユーザー管理

#### 2.4.1 法人（テナント）管理

- 法人情報
- 契約プラン
- 機能フラグ

#### 2.4.2 従業員管理

- 一覧／検索
- 招待／無効化
- アカウント認証管理

### 2.5 データ管理・集計

- 従業員アンケート集計
- チャレンジ実施状況集計
- 法人別・期間別集計
- CSVエクスポート（任意）

---

## 3. 従業員向けポータル仕様（Employee Portal）

### 3.1 トップページ

- 本日のミッション導線
- 進行中チャレンジ概要
- **クイックアクセス**：
  - アンケート
  - チャレンジ一覧
  - スコアボード
  - マイサプリ
  - 設定

### 3.2 アンケート

- 初回ログイン時は必須
- 一定期間ごとに再実施
- **質問カテゴリ**：
  - 睡眠／疲労／ストレス／食生活 等
- **UI**: ラジオ／スライダー
- **送信後**：
  - チャレンジ推薦を再計算
  - `next_survey_due_at`を保存

### 3.3 チャレンジ関連

- チャレンジ一覧（推奨表示）
- チャレンジ詳細（レシピタイムライン）
- レシピ詳細（内容・ポイント・コメント）

### 3.4 ミニミッション実行

- 本日の記事／動画表示
- 推奨サプリ表示
- 製品説明
- 外部購入リンク
- **実行チェック**：
  - 完了チェック
  - ポイント付与
- **ログ記録**：
  - 副作用
  - 体調（体重・体温等）
  - 食事写真（栄養推定はβ）

### 3.5 実感チェック・スコア

- 主観評価（5段階／スライダー）
- コメント入力
- 履歴グラフ表示
- **スコアボード**：
  - 達成率
  - 連続実施
  - 部署／法人平均比較

### 3.6 マイページ・設定

- プロフィール（年齢・性別・BMI）
- 健康情報
- チャレンジ履歴
- 通知設定（Email／LINE）

### 3.7 マイサプリ

- 推奨サプリ一覧
- 購入チェックで服用管理開始
- **服用スケジュール管理**
  - 通知設定
  - 服用ログ
  - 継続演出
  - 残量管理
- オンライン相談導線（任意）

### 3.8 副作用・体調記録

- 定期入力（例：1週間後／1ヶ月後）
- フリー入力＋チェック式
- 医師相談導線

### 3.9 通知・チャット

- Email／LINE リマインド
- Deep Link による記録画面遷移
- 医療スタッフとの1on1チャット

---

## 4. 人事（管理者）向けポータル仕様（HR Portal）

### 4.1 ダッシュボード

- 利用状況
- 継続率
- スコア分布
- 健康スコア推移
- 部署別比較

### 4.2 チャレンジ分析

- 実施率推移（期間／部署／属性）
- 人気チャレンジ／レシピ
- 効果分析（主観評価）

### 4.3 副作用・体調分析

- ログ集計
- キーワード傾向
- 匿名コメント閲覧

### 4.4 通知・リマインド管理

- 通知 ON/OFF
- 未実施ユーザー一覧
- テンプレート一括送信

### 4.5 利用者管理

- 従業員一覧／検索／フィルタ
- CSV 一括登録
- ステータス管理

### 4.6 社販管理

- 補助設定（上限／割合）
- クーポン発行
- 利用履歴管理

### 4.7 お知らせ配信

- 法人内向けお知らせ配信
- クーポン連携（任意）

---

## 5. 実装優先順位（β版）

### Phase 1: 従業員向けコアフロー（最優先）

```
アンケート → 推薦 → チャレンジ → ミニミッション → ログ
```

**実装項目**:
1. アンケート機能
2. チャレンジ推薦アルゴリズム
3. チャレンジ一覧・詳細
4. ミニミッション実行
5. ログ記録機能

### Phase 2: 提供者側コンテンツ管理

**実装項目**:
1. 栄養素材管理
2. 製品管理
3. チャレンジ／レシピ／ミニミッション管理
4. 記事・動画配信管理

### Phase 3: 人事ダッシュボード・管理・通知

**実装項目**:
1. ダッシュボード（集計・分析）
2. 利用者管理
3. 通知・リマインド管理
4. 社販管理

---

## 6. 技術要件

### 6.1 フロントエンド

- **現在**: React (Vite)
- **状態管理**: React Hooks / Context API (hoặc Redux nếu cần)
- **ルーティング**: React Router
- **UI Framework**: カスタムCSS (BEM記法)

### 6.2 バックエンド（推奨）

- **API**: RESTful API hoặc GraphQL
- **認証**: JWT Token
- **データベース**: PostgreSQL (推奨)
- **ファイルストレージ**: S3 hoặc tương đương

### 6.3 セキュリティ

- マルチテナント分離（tenant_id必須）
- RBAC実装
- HTTPS必須
- データ暗号化（PII保護）

### 6.4 通知機能

- Email通知（SMTP）
- LINE通知（LINE Messaging API）
- Push通知（PWA対応）

---

## 7. データモデル（主要エンティティ）

### 7.1 テナント（Tenant）

```
- id
- name
- plan_type
- feature_flags (JSON)
- created_at
- updated_at
```

### 7.2 ユーザー（User）

```
- id
- tenant_id
- email
- role (Provider/Employee/HR Admin)
- profile (JSON)
- status
- created_at
- updated_at
```

### 7.3 チャレンジ（Challenge）

```
- id
- tenant_id
- name
- purpose
- target_conditions (JSON)
- duration_days
- priority
- is_public
- created_at
- updated_at
```

### 7.4 レシピ（Recipe）

```
- id
- challenge_id
- name
- day_number
- content (JSON)
- expert_comment
- created_at
- updated_at
```

### 7.5 ミニミッション（Mini Mission）

```
- id
- recipe_id
- type (article/video)
- content_url
- day_number
- points
- related_supplements (JSON)
- created_at
- updated_at
```

### 7.6 サプリメント製品（Supplement Product）

```
- id
- tenant_id
- name
- ingredients (JSON)
- description
- warnings
- purchase_url
- affiliate_link
- created_at
- updated_at
```

### 7.7 アンケート（Survey）

```
- id
- tenant_id
- user_id
- responses (JSON)
- next_survey_due_at
- created_at
- updated_at
```

### 7.8 ログ（Log）

```
- id
- tenant_id
- user_id
- mission_id
- type (completion/side_effect/health_check)
- data (JSON)
- created_at
```

---

## 8. API設計（主要エンドポイント例）

### 8.1 認証

```
POST /api/auth/login
POST /api/auth/logout
POST /api/auth/refresh
```

### 8.2 チャレンジ

```
GET    /api/challenges
GET    /api/challenges/:id
POST   /api/challenges/:id/start
GET    /api/challenges/:id/recipes
```

### 8.3 ミニミッション

```
GET    /api/missions/today
POST   /api/missions/:id/complete
POST   /api/missions/:id/log
```

### 8.4 サプリメント

```
GET    /api/supplements
GET    /api/supplements/:id
POST   /api/supplements/:id/add-to-my-list
```

### 8.5 アンケート

```
GET    /api/surveys/current
POST   /api/surveys/submit
```

---

## 9. 非機能要件

### 9.1 パフォーマンス

- ページ読み込み時間: < 2秒
- API応答時間: < 500ms (平均)
- 同時接続数: 1000+ users

### 9.2 可用性

- 稼働率: 99.5%以上
- バックアップ: 日次
- 災害復旧計画: 必要

### 9.3 スケーラビリティ

- 水平スケーリング対応
- CDN利用（静的コンテンツ）
- キャッシュ戦略

---

## 10. 今後の拡張予定（β版以降）

- AI栄養推定（食事写真）
- ウェアラブルデバイス連携
- 外部健康アプリ連携（Apple Health, Google Fit）
- 多言語対応
- モバイルアプリ（React Native）

---

## 11. 参考資料

- 現在のReact実装: `/demo/src/`
- デザイン: HTML/CSS templates trong `/demo/`
- 画像リソース: `/demo/public/images/`

---

**作成日**: 2024年12月
**バージョン**: 1.0 (β版仕様)


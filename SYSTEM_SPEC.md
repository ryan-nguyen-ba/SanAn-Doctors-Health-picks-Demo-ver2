# システム仕様書

**プロダクト名：** Health Picks（仮）  
**対象：** 提供者側／従業員向け／人事（管理者）向け 3 Portal

---

## 1. システム概要

本システムは、法人（テナント）向けに健康支援サービスを提供する ポータル型アプリケーションであり、以下 3 種類のポータルで構成される。

- 提供者側ポータル（コンテンツ・サービス管理）
- 従業員向けポータル（健康行動・記録・チャレンジ実行）
- 人事（管理者）向けポータル（分析・管理・通知）

EC 機能は持たず、製品購入はすべて外部サービスへの遷移とする。

---

## 2. 共通仕様（全ポータル共通）

### 2.1 マルチテナント仕様

- 法人を **テナント（tenant）** として管理する
- すべてのデータは `tenant_id` により完全分離されること
  - 従業員データ
  - アンケート・チャレンジ・ログ
  - 分析結果
  - 通知・クーポン

### 2.2 ロール・権限管理（RBAC）

以下のロールを持つ：

| ロール | 説明 |
|--------|------|
| Provider | 提供者側（サービス運営・コンテンツ管理） |
| Employee | 従業員 |
| HR Admin | 法人管理者（人事） |

- ロールに応じてアクセス可能な画面・APIを制限する
- 他ロールのポータルへの直接アクセスは禁止

### 2.3 ECポリシー

- 注文／決済／在庫／配送は管理しない
- 製品情報は **情報表示のみ**
- 購入は外部リンク（通常URL／アフィリエイト／API）へ遷移

---

## 3. 提供者側ポータル仕様（Provider Portal）

### 3.1 製品情報管理

#### 3.1.1 栄養素材管理（Ingredient）

- 栄養素材の CRUD を行う
- 管理項目：
  - 栄養素材名
  - 栄養素情報（成分名／量／単位、JSON形式可）
  - 説明文
  - 注意事項（副作用等）
  - 公開／非公開フラグ

#### 3.1.2 製品管理（Supplement Product）

- サプリメント製品の CRUD を行う
- 管理項目：
  - 製品名
  - 関連栄養素材（複数）
  - 効果・効能説明
  - 注意点・副作用
  - 購入導線情報
    - 通常URL
    - アフィリエイトリンク
    - 外部API情報（必要な場合）

※ 従業員ポータルの購入ボタンは、必ずここで登録されたリンクに遷移する

---

### 3.2 チャレンジ／レシピ／ミニミッション管理

#### 3.2.1 チャレンジ管理

- チャレンジの CRUD
- 管理項目：
  - チャレンジ名
  - 目的（改善したい課題）
  - 対象条件（年齢・性別・アンケート結果等）
  - 実施期間（任意）
  - 推奨フラグ／優先度
  - 公開状態

#### 3.2.2 レシピ管理

- チャレンジ配下でレシピを管理
- 管理項目：
  - レシピ名
  - 実施日数（Day1〜）
  - 構成内容（食事／運動／睡眠／サプリ等）
  - 専門家コメント（任意）

#### 3.2.3 ミニミッション管理

- レシピ配下でミニミッションを管理
- 管理項目：
  - ミッション種別（記事／動画）
  - コンテンツ本文または動画URL
  - 実施日（Day番号）
  - 付与ポイント
  - 関連サプリ（複数可）

---

### 3.3 記事・動画配信管理

- 記事／動画コンテンツの登録
- 配信スケジュール管理：
  - 公開日時
  - 配信対象（全員／特定チャレンジ／条件）
  - 公開／下書きステータス管理

---

### 3.4 ユーザー管理

- **法人（テナント）管理**
  - 法人情報
  - 契約プラン
  - 機能フラグ
- **従業員管理**
  - 一覧／検索
  - 招待／無効化
  - アカウント認証管理

---

### 3.5 データ管理・集計

- 従業員アンケート集計
- チャレンジ実施状況集計
- 法人別・期間別集計
- CSVエクスポート（任意）

---

## 4. 従業員向けポータル仕様（Employee Portal）

### 4.1 トップページ

- 本日のミッション導線
- 進行中チャレンジ概要
- クイックアクセス：
  - アンケート
  - チャレンジ一覧
  - スコアボード
  - マイサプリ
  - 設定

---

### 4.2 アンケート

- 初回ログイン時は必須
- 一定期間ごとに再実施
- 質問カテゴリ：
  - 睡眠／疲労／ストレス／食生活 等
- UI：ラジオ／スライダー
- 送信後：
  - チャレンジ推薦を再計算
  - `next_survey_due_at` を保存

---

### 4.3 チャレンジ関連

- チャレンジ一覧（推奨表示）
- チャレンジ詳細（レシピタイムライン）
- レシピ詳細（内容・ポイント・コメント）

---

### 4.4 ミニミッション実行

- 本日の記事／動画表示
- 推奨サプリ表示
- 製品説明
- 外部購入リンク
- 実行チェック：
  - 完了チェック
  - ポイント付与
- ログ記録：
  - 副作用
  - 体調（体重・体温等）
  - 食事写真（栄養推定はβ）

---

### 4.5 実感チェック・スコア

- 主観評価（5段階／スライダー）
- コメント入力
- 履歴グラフ表示
- スコアボード：
  - 達成率
  - 連続実施
  - 部署／法人平均比較

---

### 4.6 マイページ・設定

- プロフィール（年齢・性別・BMI）
- 健康情報
- チャレンジ履歴
- 通知設定（Email／LINE）

---

### 4.7 マイサプリ

- 推奨サプリ一覧
- 購入チェックで服用管理開始
- 服用スケジュール管理
- 通知設定
- 服用ログ
- 継続演出
- 残量管理
- オンライン相談導線（任意）

---

### 4.8 副作用・体調記録

- 定期入力（例：1週間後／1ヶ月後）
- フリー入力＋チェック式
- 医師相談導線

---

### 4.9 通知・チャット

- Email／LINE リマインド
- Deep Link による記録画面遷移
- 医療スタッフとの1on1チャット

---

## 5. 人事（管理者）向けポータル仕様（HR Portal）

### 5.1 ダッシュボード

- 利用状況
- 継続率
- スコア分布
- 健康スコア推移
- 部署別比較

---

### 5.2 チャレンジ分析

- 実施率推移（期間／部署／属性）
- 人気チャレンジ／レシピ
- 効果分析（主観評価）

---

### 5.3 副作用・体調分析

- ログ集計
- キーワード傾向
- 匿名コメント閲覧

---

### 5.4 通知・リマインド管理

- 通知 ON/OFF
- 未実施ユーザー一覧
- テンプレート一括送信

---

### 5.5 利用者管理

- 従業員一覧／検索／フィルタ
- CSV 一括登録
- ステータス管理

---

### 5.6 社販管理

- 補助設定（上限／割合）
- クーポン発行
- 利用履歴管理

---

### 5.7 お知らせ配信

- 法人内向けお知らせ配信
- クーポン連携（任意）

---

## 6. 実装優先順位（β版）

1. **従業員向けコアフロー**
   アンケート → 推薦 → チャレンジ → ミニミッション → ログ

2. **提供者側コンテンツ管理**

3. **人事ダッシュボード・管理・通知**

---

**作成日：** 2025-01-XX  
**バージョン：** 1.0

